{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/paula.lafon/projects/learning/learndotnet/webapp/examples/MinimalJwtAngular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpHeaders } from '@angular/common/http';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./storage.service\";\nexport class AuthService {\n  constructor(http, storageService) {\n    this.http = http;\n    this.storageService = storageService;\n    this.userApiUrl = 'https://localhost:7113';\n  }\n  tryRefreshingTokens() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const token = _this.storageService.getToken();\n      const refreshToken = _this.storageService.getRefreshToken();\n      if (!token || !refreshToken) {\n        return false;\n      }\n      const credentials = JSON.stringify({\n        accessToken: token,\n        refreshToken: refreshToken\n      });\n      let isRefreshSuccess;\n      const refreshRes = yield new Promise((resolve, reject) => {\n        _this.http.post(\"https://localhost:5001/api/token/refresh\", credentials, {\n          headers: new HttpHeaders({\n            \"Content-Type\": \"application/json\"\n          })\n        }).subscribe({\n          next: res => resolve(res),\n          error: _ => {\n            reject;\n            isRefreshSuccess = false;\n          }\n        });\n      });\n      localStorage.setItem(\"jwt\", refreshRes.token);\n      localStorage.setItem(\"refreshToken\", refreshRes.refreshToken);\n      isRefreshSuccess = true;\n      return isRefreshSuccess;\n    })();\n  }\n  login(username, password) {\n    return this.http.post(this.userApiUrl + '/login', {\n      username,\n      password\n    }).pipe(tryRetr);\n  }\n}\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.StorageService));\n};\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["HttpHeaders","AuthService","constructor","http","storageService","userApiUrl","tryRefreshingTokens","_this","_asyncToGenerator","token","getToken","refreshToken","getRefreshToken","credentials","JSON","stringify","accessToken","isRefreshSuccess","refreshRes","Promise","resolve","reject","post","headers","subscribe","next","res","error","_","localStorage","setItem","login","username","password","pipe","tryRetr","i0","ɵɵinject","i1","HttpClient","i2","StorageService","factory","ɵfac","providedIn"],"sources":["C:\\Users\\paula.lafon\\projects\\learning\\learndotnet\\webapp\\examples\\MinimalJwtAngular\\src\\app\\services\\auth.service.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\nimport { StorageService } from './storage.service';\r\n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n\n\n  private userApiUrl = 'https://localhost:7113';\n\n  constructor(private http: HttpClient, private storageService: StorageService) { }\n\n  private async tryRefreshingTokens(): Promise<boolean> {\r\n\r\n    const token: any = this.storageService.getToken();\r\n    const refreshToken: any = this.storageService.getRefreshToken()\r\n    if (!token || !refreshToken) {\r\n      return false;\r\n    }\r\n\r\n    const credentials = JSON.stringify({ accessToken: token, refreshToken: refreshToken });\r\n    let isRefreshSuccess: boolean;\r\n    const refreshRes = await new Promise<AuthenticatedResponse>((resolve, reject) => {\r\n      this.http.post<AuthenticatedResponse>(\"https://localhost:5001/api/token/refresh\", credentials, {\r\n        headers: new HttpHeaders({\r\n          \"Content-Type\": \"application/json\"\r\n        })\r\n      }).subscribe({\r\n        next: (res: AuthenticatedResponse) => resolve(res),\r\n        error: (_) => { reject; isRefreshSuccess = false; }\r\n      });\r\n    });\r\n    localStorage.setItem(\"jwt\", refreshRes.token);\r\n    localStorage.setItem(\"refreshToken\", refreshRes.refreshToken);\r\n    isRefreshSuccess = true;\r\n    return isRefreshSuccess;\r\n  }\n\n  login(username: string, password: string): Observable<any> {\n    return this.http.post(\n      this.userApiUrl + '/login',\n      {\n        username,\n        password\n      },\n      \n    ).pipe(\n      tryRetr\n    );\n  }\n}\n"],"mappings":";AAAA,SAAqBA,WAAW,QAAQ,sBAAsB;;;;AAU9D,OAAM,MAAOC,WAAW;EAKtBC,YAAoBC,IAAgB,EAAUC,cAA8B;IAAxD,KAAAD,IAAI,GAAJA,IAAI;IAAsB,KAAAC,cAAc,GAAdA,cAAc;IAFpD,KAAAC,UAAU,GAAG,wBAAwB;EAEmC;EAElEC,mBAAmBA,CAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MAE/B,MAAMC,KAAK,GAAQF,KAAI,CAACH,cAAc,CAACM,QAAQ,EAAE;MACjD,MAAMC,YAAY,GAAQJ,KAAI,CAACH,cAAc,CAACQ,eAAe,EAAE;MAC/D,IAAI,CAACH,KAAK,IAAI,CAACE,YAAY,EAAE;QAC3B,OAAO,KAAK;;MAGd,MAAME,WAAW,GAAGC,IAAI,CAACC,SAAS,CAAC;QAAEC,WAAW,EAAEP,KAAK;QAAEE,YAAY,EAAEA;MAAY,CAAE,CAAC;MACtF,IAAIM,gBAAyB;MAC7B,MAAMC,UAAU,SAAS,IAAIC,OAAO,CAAwB,CAACC,OAAO,EAAEC,MAAM,KAAI;QAC9Ed,KAAI,CAACJ,IAAI,CAACmB,IAAI,CAAwB,0CAA0C,EAAET,WAAW,EAAE;UAC7FU,OAAO,EAAE,IAAIvB,WAAW,CAAC;YACvB,cAAc,EAAE;WACjB;SACF,CAAC,CAACwB,SAAS,CAAC;UACXC,IAAI,EAAGC,GAA0B,IAAKN,OAAO,CAACM,GAAG,CAAC;UAClDC,KAAK,EAAGC,CAAC,IAAI;YAAGP,MAAM;YAAEJ,gBAAgB,GAAG,KAAK;UAAE;SACnD,CAAC;MACJ,CAAC,CAAC;MACFY,YAAY,CAACC,OAAO,CAAC,KAAK,EAAEZ,UAAU,CAACT,KAAK,CAAC;MAC7CoB,YAAY,CAACC,OAAO,CAAC,cAAc,EAAEZ,UAAU,CAACP,YAAY,CAAC;MAC7DM,gBAAgB,GAAG,IAAI;MACvB,OAAOA,gBAAgB;IAAC;EAC1B;EAEAc,KAAKA,CAACC,QAAgB,EAAEC,QAAgB;IACtC,OAAO,IAAI,CAAC9B,IAAI,CAACmB,IAAI,CACnB,IAAI,CAACjB,UAAU,GAAG,QAAQ,EAC1B;MACE2B,QAAQ;MACRC;KACD,CAEF,CAACC,IAAI,CACJC,OAAO,CACR;EACH;;AA5CWlC,WAAW,C;mBAAXA,WAAW,EAAAmC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,cAAA;AAAA;AAAXxC,WAAW,C;SAAXA,WAAW;EAAAyC,OAAA,EAAXzC,WAAW,CAAA0C,IAAA;EAAAC,UAAA,EAFV;AAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}